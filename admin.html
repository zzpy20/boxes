<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <title>ğŸ›  Admin - keys only</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="robots" content="noindex" />
  <style>
    :root { --bg:#f6f7f9; --card:#fff; --text:#111; --muted:#666; --line:#e6e8ee; --btn:#111; --btnText:#fff; }
    body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,"PingFang SC","Hiragino Sans GB","Microsoft YaHei",sans-serif;margin:0;padding:16px;background:var(--bg);color:var(--text);}
    header{max-width:1180px;margin:0 auto 12px;}
    h1{margin:0 0 8px;font-size:20px;}
    .sub{color:var(--muted);font-size:13px;line-height:1.45;margin:0 0 10px;}
    .bar{max-width:1180px;margin:0 auto 10px;display:flex;flex-wrap:wrap;gap:10px;align-items:center;}
    .bar input[type="search"]{flex:1;min-width:220px;padding:10px 12px;border-radius:12px;border:1px solid var(--line);background:#fff;}
    .btn{padding:10px 12px;border-radius:12px;border:1px solid var(--line);background:#fff;cursor:pointer;font-size:13px;}
    .btn.primary{background:var(--btn);color:var(--btnText);border-color:var(--btn);}
    .wrap{max-width:1180px;margin:0 auto;background:var(--card);border:1px solid var(--line);border-radius:14px;overflow:hidden;}
    table{width:100%;border-collapse:collapse;}
    th,td{border-bottom:1px solid var(--line);padding:10px;vertical-align:top;}
    th{background:#fafbfc;text-align:left;font-size:12px;color:#334155;position:sticky;top:0;z-index:2;}
    td{font-size:13px;}
    .id{width:80px;font-weight:800;white-space:nowrap;}
    input[type="text"],textarea{width:100%;box-sizing:border-box;padding:8px 10px;border-radius:10px;border:1px solid var(--line);background:#fff;font-size:13px;outline:none;}
    textarea{min-height:42px;resize:vertical;}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono",monospace;font-size:12px;}
    .rowHidden{display:none;}
    footer{max-width:1180px;margin:12px auto 0;color:var(--muted);font-size:12px;text-align:center;}
    details{max-width:1180px;margin:0 auto 10px;}
    details>summary{cursor:pointer;color:#334155;font-size:13px;}
    .bulkBox{background:#fff;border:1px solid var(--line);border-radius:14px;padding:12px;margin-top:10px;}
    .bulkBox textarea{min-height:120px;}
    .bulkRow{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-top:10px;}
    .small{font-size:12px;color:var(--muted);}
    .pill{display:inline-block;padding:2px 8px;border:1px solid var(--line);border-radius:999px;background:#fff;font-size:12px;color:#475569;}
  </style>
</head>
<body>
<header>
  <h1>ğŸ›  Adminï¼šåªç¼–è¾‘ key / å¤‡æ³¨ / tagsï¼ˆURL ç§æœ‰åœ¨ Cloudflare KVï¼‰</h1>
  <p class="sub">
    è¿™é‡Œä¸å­˜ URLã€‚<b>key</b> å¿…é¡»ä¸ä½  Cloudflare KV çš„é”®ä¸€è‡´ï¼ˆä¾‹å¦‚ <span class="pill">kitchen_docs</span>ï¼‰ã€‚<br>
    ç¼–è¾‘å®Œï¼š<b>Download boxes.json</b> â†’ ä¸Šä¼ è¦†ç›– GitHub ä»“åº“æ ¹ç›®å½•å¹¶ commitã€‚
  </p>
</header>

<div class="bar">
  <input id="search" type="search" placeholder="æœç´¢ï¼š01 / key / å…³é”®è¯ / tags ..." />
  <button class="btn" id="loadRemote">Load current boxes.json</button>
  <label class="btn" for="fileIn">Import boxes.json</label>
  <input id="fileIn" type="file" accept="application/json" style="display:none" />
  <button class="btn primary" id="download">Download boxes.json</button>
</div>

<details>
  <summary>âš¡ æ‰¹é‡ç²˜è´´ KEYï¼ˆä¸€è¡Œä¸€ä¸ªï¼‰â†’ è‡ªåŠ¨å¡«å…… BOX-01..BOX-50</summary>
  <div class="bulkBox">
    <div class="small">
      æ”¯æŒä¸¤ç§æ ¼å¼ï¼š<span class="pill">kitchen_docs</span>ï¼ˆæŒ‰é¡ºåºï¼‰ æˆ– <span class="pill">01,kitchen_docs</span>ï¼ˆæŒ‰ IDï¼‰
    </div>
    <textarea id="bulkText" class="mono" placeholder="kitchen_docs\nwinter_clothes\n...\næˆ–ï¼š\n01,kitchen_docs\n02,winter_clothes"></textarea>
    <div class="bulkRow">
      <button class="btn primary" id="applyBulk">Apply to KEY column</button>
      <button class="btn" id="clearBulk">Clear</button>
      <span class="small" id="bulkStatus"></span>
    </div>
  </div>
</details>

<div class="wrap">
  <table>
    <thead>
      <tr>
        <th class="id">ID</th>
        <th>KEY (KV key)</th>
        <th>Note / å¤‡æ³¨</th>
        <th>Tags</th>
        <th>Preview path</th>
      </tr>
    </thead>
    <tbody id="tbody"></tbody>
  </table>
</div>

<footer>çœŸå® URL ä¸åœ¨ GitHubï¼›åœ¨ Cloudflare KVï¼škey â†’ URLï¼ˆç§æœ‰ï¼‰</footer>

<script>
  const BOX_COUNT = 50;
  const pad2=n=>String(n).padStart(2,"0");
  const norm=s=>(s||"").toString().trim().toLowerCase();
  const splitTags=s=>{
    const raw=(s||"").trim(); if(!raw) return [];
    return raw.split(/[;,]/g).flatMap(p=>p.split(/\s+/g)).map(t=>t.trim()).filter(Boolean);
  };
  const joinTags=arr=>Array.isArray(arr)?arr.map(x=>String(x).trim()).filter(Boolean).join(" "):"";

  function makeEmpty(){ const out=[]; for(let i=1;i<=BOX_COUNT;i++) out.push({id:pad2(i),key:"",note:"",tags:[],preview:""}); return out; }
  let state={ boxes: makeEmpty() };

  function escapeHtml(s){ return (s||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"); }

  function render(){
    const tbody=document.getElementById("tbody"); tbody.innerHTML="";
    for(const b of state.boxes){
      const tr=document.createElement("tr");
      tr.dataset.search=[b.id,b.key||"",b.note||"",joinTags(b.tags),b.preview||""].join(" ").toLowerCase();
      tr.innerHTML = `
        <td class="id">BOX-${b.id}</td>
        <td><input class="mono" type="text" data-k="key" value="${escapeHtml(b.key||"")}" placeholder="kitchen_docs" /></td>
        <td><textarea data-k="note" placeholder="ä¾‹å¦‚ï¼šå……ç”µçº¿/ç”µæºé€‚é…å™¨...">${escapeHtml(b.note||"")}</textarea></td>
        <td><input type="text" data-k="tags" value="${escapeHtml(joinTags(b.tags))}" placeholder="cables chargers kids ..." /></td>
        <td><input class="mono" type="text" data-k="preview" value="${escapeHtml(b.preview||"")}" placeholder="previews/box-01.jpg" /></td>
      `;
      tr.querySelectorAll("[data-k]").forEach(el=>{
        el.addEventListener("input",()=>{
          const k=el.dataset.k;
          if(k==="tags") b.tags=splitTags(el.value);
          else b[k]=el.value;
          tr.dataset.search=[b.id,b.key||"",b.note||"",joinTags(b.tags),b.preview||""].join(" ").toLowerCase();
        });
      });
      tbody.appendChild(tr);
    }
  }

  async function loadRemote(){
    const res=await fetch("./boxes.json",{cache:"no-store"});
    if(!res.ok) throw new Error("boxes.json not found");
    const data=await res.json();
    const boxes=Array.isArray(data.boxes)?data.boxes:[];
    const map=new Map();
    for(const r of boxes){
      const id=pad2(parseInt(r.id,10));
      map.set(id,{ id, key:(r.key||"").toString(), note:(r.note||"").toString(), tags:Array.isArray(r.tags)?r.tags:splitTags(r.tags||""), preview:(r.preview||"").toString() });
    }
    const full=[]; for(let i=1;i<=BOX_COUNT;i++){ const id=pad2(i); full.push(map.get(id) || {id,key:"",note:"",tags:[],preview:""}); }
    state.boxes=full; render(); setStatus("Loaded âœ…");
  }

  function downloadJson(){
    const out={ boxes: state.boxes.map(b=>({ id:b.id, key:(b.key||"").toString().trim(), note:(b.note||"").toString(), tags:Array.isArray(b.tags)?b.tags:splitTags(b.tags||""), preview:(b.preview||"").toString().trim() })) };
    const blob=new Blob([JSON.stringify(out,null,2)],{type:"application/json;charset=utf-8"});
    const a=document.createElement("a"); a.href=URL.createObjectURL(blob); a.download="boxes.json";
    document.body.appendChild(a); a.click(); a.remove();
    setTimeout(()=>URL.revokeObjectURL(a.href),1500);
  }

  document.getElementById("search").addEventListener("input",(e)=>{
    const term=norm(e.target.value);
    document.querySelectorAll("#tbody tr").forEach(tr=>tr.classList.toggle("rowHidden", term && !tr.dataset.search.includes(term)));
  });

  document.getElementById("fileIn").addEventListener("change", async (e)=>{
    const file=e.target.files && e.target.files[0]; if(!file) return;
    const text=await file.text();
    try{
      const data=JSON.parse(text);
      const boxes=Array.isArray(data.boxes)?data.boxes:[];
      const map=new Map();
      for(const r of boxes){
        const id=pad2(parseInt(r.id,10));
        map.set(id,{ id, key:(r.key||"").toString(), note:(r.note||"").toString(), tags:Array.isArray(r.tags)?r.tags:splitTags(r.tags||""), preview:(r.preview||"").toString() });
      }
      const full=[]; for(let i=1;i<=BOX_COUNT;i++){ const id=pad2(i); full.push(map.get(id) || {id,key:"",note:"",tags:[],preview:""}); }
      state.boxes=full; render(); setStatus("Imported âœ…");
    } catch(err){ alert("Invalid JSON."); }
    finally{ e.target.value=""; }
  });

  // Bulk keys
  function setStatus(msg){ const el=document.getElementById("bulkStatus"); if(el) el.textContent=msg||""; }
  function parseBulk(text){
    const lines=text.split(/\r?\n/).map(l=>l.trim()).filter(Boolean);
    const items=[];
    for(const line of lines){
      const m=line.match(/^\s*(\d{1,2})\s*,\s*([a-zA-Z0-9_\-\.]+)\s*$/);
      if(m) items.push({id:pad2(parseInt(m[1],10)), key:m[2].trim()});
      else items.push({id:null, key:line});
    }
    return items;
  }
  function applyBulk(){
    const items=parseBulk(document.getElementById("bulkText").value||"");
    if(!items.length){ setStatus("No lines."); return; }
    const hasId=items.some(x=>x.id);
    let updated=0;
    if(hasId){
      const map=new Map(); for(const it of items){ if(it.id && it.key) map.set(it.id,it.key); }
      for(const b of state.boxes){ if(map.has(b.id)){ b.key=map.get(b.id); updated++; } }
      render(); setStatus(`Applied by ID âœ… ${updated}`);
      return;
    }
    for(let i=0;i<state.boxes.length && i<items.length;i++){
      const k=(items[i].key||"").trim(); if(!k) continue;
      state.boxes[i].key=k; updated++;
    }
    render(); setStatus(`Applied sequentially âœ… ${updated}`);
  }
  document.getElementById("applyBulk").addEventListener("click", applyBulk);
  document.getElementById("clearBulk").addEventListener("click", ()=>{ document.getElementById("bulkText").value=""; setStatus(""); });

  document.getElementById("loadRemote").addEventListener("click", ()=>loadRemote().catch(err=>alert(err.message)));
  document.getElementById("download").addEventListener("click", downloadJson);

  render();
</script>
</body>
</html>
